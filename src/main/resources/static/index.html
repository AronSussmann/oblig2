<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="jquery-3.7.1.min.js"></script>
</head>
<body>
<h1>Bestilling av kinobiletter</h1>
<!-- Lar brukeren velge film -->
<label for="filmer">Velg film her:</label>
<select name="filmer" id="filmer">
    <option value="Pjango">Pjango</option>
    <option value="Y-men">Y-men</option>
    <option value="Fantastic 5">Fantastic 5</option>
    <option value="Revengers">Revengers</option>
</select>
<!--Lar brukeren velge antall biletter input må være tall mellom 0 og 100 -->
<table>
    <tr>
        <td><label for="antallBiletter">Antall:</label></td>
        <td><input type="number" min="1" step="1" max="100" id="antallBiletter" name="antallBiletter" style="width: 40px;"></td>
    </tr>
</table>

<table>
    <tr>
        <td><label for="fornNavn">Fornavn:</label></td>
        <td><input type="text" id="fornNavn" name="fornNavn"></td>
    </tr>
    <tr>
        <td><label for="etterNavn">Etternavn:</label></td>
        <td><input type="text" id="etterNavn" name="etterNavn"></td>
    </tr>
    <tr>
        <td><label for="telefonNr">Telefonnr:</label></td>
        <td><input type="text" id="telefonNr" name="telefonNr"></td>
    </tr>
    <tr>
        <td><label for="epost">Epost:</label></td>
        <td><input type="text" id="epost" name="epost"></td>
    </tr>
</table>

<button onclick="testInfo();lagreInfo()">Kjøp Biletter</button>

<h2>Alle billetter</h2>
<p id="output"></p>

<button onclick="slettArray()">Slett alle bilettene</button>
<script>

    function testInfo() {
        let telefonNrRegex = /^(\+\d{1,3}[- ]?)?\d{8}$/;
        let epostRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        let navnRegex = /^[a-zA-ZæøåÆØÅ' ]{2,30}$/;

        let fornNavn = document.getElementById("fornNavn").value;
        let etterNavn = document.getElementById("etterNavn").value;
        let telefonNr = document.getElementById("telefonNr").value;
        let epost = document.getElementById("epost").value;
        let antallBiletter = document.getElementById("antallBiletter").value;

        // Validerer om det er skrevet tekst i input boksene
        if (fornNavn === "" || etterNavn === "" || telefonNr === "" || epost === "" || antallBiletter === "") {
            alert("Alle felt må fylles ut");
            return false; // Stopp funksjonen her
        }

        // Bruker regex og if setninger for å sjekke om de oppfyller kravene
        if (!telefonNrRegex.test(telefonNr)) {
            alert("Vennligst skriv inn et gyldig telefonnummer");
            return false;
        }

        if (!epostRegex.test(epost)) {
            alert("Vennligst skriv inn en gyldig e-postadresse");
            return false;
        }
        if (!navnRegex.test(fornNavn + etterNavn)) {
            alert("Skriv inn et gyldig navn")
            return false;
        }

    }

    function lagreInfo(){
        const billett = {
            film: $("#filmer").val(),
            antall: $("#antallBiletter").val(),
            fornavn: $("#fornNavn").val(),
            etternavn: $("#etterNavn").val(),
            telefon: $("#telefonNr").val(),
            epost: $("#epost").val()
        };
        $.post("/lagre", billett, function(){
            hentBilletter();
        });

        // Tøm input-feltene
        $("#filmer").val("");
        $("#antallBiletter").val("");
        $("#fornNavn").val("");
        $("#etterNavn").val("");
        $("#telefonNr").val("");
        $("#epost").val("");


    }
    function hentBilletter(){
        $.get("/hentBilletter", function(visBilletter){
            formaterBilletter(visBilletter);
        });
    }
    function formaterBilletter(billetter){
        let ut = "";
        for (let billett of billetter){
            ut += "Film: " + billett.film + " Antall: " + billett.antall + " Navn: " + billett.fornavn + " " + billett.etternavn + " Telefon: " + billett.telefon + " Epost: " + billett.epost + "<br>";
        }
        $("#output").html(ut);
    }

</script>
</body>
</html>